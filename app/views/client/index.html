<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>TaskCentral</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="maximum-scale=1, user-scalable=no, minimal-ui, width=device-width, initial-scale=1">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#8F7034">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#8F7034">

    <link href="https://fonts.googleapis.com/icon?family=Roboto" rel="stylesheet">
    <link rel="icon" type="image/png" href="/assets/android-chrome-192x192.png" sizes="192x192">

    <style>
      :root {
        --app-primary-color: #8F7034;
      }
    </style>

    <!-- the only essential css not to lazy load -->
    <link rel="stylesheet" href="libs/ui/splash.css" />

  </head>
  <body>
    <div id="splash">
      <h1>T</h1>
      <span id="splash-status"></span>
    </div>

    <div class="top-bar" oncontextmenu="return false;">
      <div class="pure-menu pure-menu-horizontal">
        <ul class="pure-menu-list">
          <li class="pure-menu-item">
            <a href="#" data-menu="home" class="pure-menu-link">Home</a>
          </li>
          <li class="pure-menu-item">
            <a href="#" data-menu="gantt" class="pure-menu-link">Gantt</a>
          </li>
          <li class="pure-menu-item">
            <a href="#" data-menu="log" class="pure-menu-link">Log</a>
          </li>
          <li class="pure-menu-item">
            <a href="#" data-menu="metrics" class="pure-menu-link">Metrics</a>
          </li>
          <li class="pure-menu-item">
            <a href="#" data-menu="forecast" class="pure-menu-link">Forecast</a>
          </li>
          <li class="pure-menu-item">
            <a href="#" data-menu="settings" class="pure-menu-link">User</a>
          </li>
        </ul>
      </div>
    </div>

    <div class="content-container">
      <div class="home">
        <div class="task-container">
          <div class="actions pad">
            <button class="pure-button" id="home-mode-button"
              style="text-transform: capitalize;"
              onclick="ui_home_mode_select()">
              default
            </button>
            <button class="pure-button" onclick="ui_filter_open(HOME_QUERY, ui_home_update_list)">
              Filter <i class="fa fa-filter"></i>
            </button>
            <div class="filters-holder"></div>
          </div>
          <form id="add-form" autocomplete="off" onsubmit="ui_home_add_trigger(); return false;">
            <div class="input-row">
              <i class="fa fa-plus"></i>
              <div class="input-wrapper">
                <input type="text" name="name" onfocus="ui_home_add_input_focus()" placeholder="Add task...">
              </div>

              <input type="hidden" name="project" onchange="ui_home_add_project_changed(this);ui_home_add_input_focus()">
              <div class="project"></div>
              <div class="tags"></div>

              <div class="datepicker">
                <i class="fa fa-calendar-alt"></i>
                <input type="date" name="due" onchange="ui_home_add_date_changed(this);ui_home_focus_input();">
              </div>
              <div class="date-due" style="display: none;" onclick="ui_home_remove_due_date();ui_home_focus_input();">
                Tomorrow
              </div>
            </div>
            <div class="detail-row">
              <sub-title>PROJECT</sub-title>
              <div class="projects"></div>
              <sub-title>PRIORITY</sub-title>
              <input type="range" min="0" max="10" step="1" name="priority">
              <sub-title>WEIGHT</sub-title>
              <input type="range" min="0" max="10" step="1" name="weight">
              <!-- TODO: stub -->
              <!-- <sub-title>TAGS</sub-title> -->
            </div>
          </form>
          <div class="task-list">

          </div>
        </div>
        <div class="task-detail">
          <form onsubmit="return false;" oncontextmenu="return false;">
            <header>
              <div></div>
              <i class="fa fa-check" onclick="ui_detail_close()"></i>
            </header>
            <form-body class="pure-form pure-form-aligned">
              <div class="pure-control-group">
                <label>Name</label>
                <input type="text" name="name">
              </div>
              <div class="pure-control-group">
                <label style="vertical-align: top">Project</label>
                <input type="hidden" name="project" onchange="ui_home_detail_project_changed(this)">
                <div class="project-container">
                  <div class="project"></div>
                  <div class="projects"></div>
                </div>
              </div>
              <div class="pure-control-group">
                <label>Priority</label>
                <input type="range" min="0" max="10" step="1" name="priority">
              </div>
              <div class="pure-control-group">
                <label>Weight</label>
                <input type="range" min="0" max="10" step="1" name="weight">
              </div>
              <div class="pure-control-group">
                <label>Progress</label>
                <input type="range" min="0" max="100" step="1" name="progress">
              </div>
              <div class="pure-control-group">
                <label>Due</label>
                <input type="date" name="due">
              </div>
              <div class="pure-control-group">
                <label>Earliest</label>
                <input type="date" name="earliest">
              </div>
              <div class="pure-control-group">
                <label>Until</label>
                <input type="date" name="until">
              </div>
              <div class="pure-control-group">
                <label>Visibility</label>
                <label for="home-details-hidden-checkbox" class="pure-checkbox"
                  style="text-align: left;">
                  <input type="checkbox" name="hidden" id="home-details-hidden-checkbox"> Hidden
                </label>
              </div>
              <div class="pure-control-group">
                <label>Time spent</label>
                <input type="text" readonly name="total">
              </div>
              <div class="pure-control-group">
                <label>Status</label>
                <input type="text" readonly name="status">
              </div>
              <div class="pure-control-group">
                <label>Notes</label>
                <span name="notes" class="textarea" contenteditable
                  style="resize: none;"
                  onpaste="onPasteFormatRemovalHandler(this, event)"></span>
              </div>
              <div class="pure-control-group">
                <label>Created</label>
                <input type="text" readonly name="created">
              </div>
              <div class="pure-control-group">
                <label>Log</label>
                <textarea readonly name="log" style="height: 7.5em;font-family: var(--mono-family);"></textarea>
              </div>
              <!-- TODO: total time & log -->
            </form-body>
          </form>
        </div>
      </div>
      <div class="gantt" oncontextmenu="return false;">
        <header>
          <div class="actions pad">
            <button class="pure-button"
              onclick="GANTT_QUERY = JSON.parse(JSON.stringify(GANTT_DEFAULT_QUERY));ui_gantt_render()">
              Reset
            </button>
            <button class="pure-button" onclick="ui_gantt_scroll_to_today()">
              Today
            </button>
            <button class="pure-button" onclick="ui_filter_open(GANTT_QUERY, ui_gantt_render)">
              Filter <i class="fa fa-filter"></i>
            </button>
            <div class="filters-holder"></div>
          </div>
        </header>
        <gantt-container>
          <!-- programatically scrolled -->
          <gantt-header></gantt-header>
          <gantt-graph></gantt-graph>
        </gantt-container>
      </div>
      <div class="log" oncontextmenu="return false;">
        <header>
          <div class="actions pad">
            <button class="pure-button"
              onclick="LOG_QUERY = JSON.parse(JSON.stringify(LOG_DEFAULT_QUERY));ui_log_render()">
              Reset
            </button>
            <button class="pure-button" onclick="ui_filter_open(LOG_QUERY, ui_log_render)">
              Filter <i class="fa fa-filter"></i>
            </button>
            <div class="filters-holder"></div>
          </div>
        </header>
        <grid>
          <div>
            <cal class="info-card">
              <div class="info-action">
                <i class="fa fa-chevron-left"></i>
                <div class="title"></div>
                <i class="fa fa-chevron-right"></i>
              </div>
              <header class="stats">
                <stat style="min-width: 33.3333%;">
                  <strong>NUM</strong>
                  <num name="num"></num>
                </stat>
                <stat style="min-width: 33.3333%;">
                  <strong>SUM</strong>
                  <num name="sum"></num>
                </stat>
                <stat style="min-width: 33.3333%;">
                  <strong>AVG</strong>
                  <num name="avg"></num>
                </stat>
              </header>
              <div class="content days-header"></div>
              <div class="backdrop-scroll">
                <div class="content backdrop-container"></div>
              </div>
            </cal>
          </div>
          <div>
            <daily class="info-card">
              <div class="info-action">
                <i class="fa fa-chevron-left"></i>
                <div class="title"></div>
                <i class="fa fa-chevron-right"></i>
              </div>
              <header class="stats">
                <stat style="min-width: 33.3333%;">
                  <strong>NUM</strong>
                  <num name="num">3.2hr</num>
                </stat>
                <stat style="min-width: 33.3333%;">
                  <strong>SUM</strong>
                  <num name="sum">3.2hr</num>
                </stat>
                <stat style="min-width: 33.3333%;">
                  <strong>AVG</strong>
                  <num name="avg">3.2hr</num>
                </stat>
              </header>
              <div class="content"></div>
            </daily>
          </div>
        </grid>
      </div>
      <div class="metrics" oncontextmenu="return false;">
        <header>
          <div class="actions pad">
            <button class="pure-button"
              onclick="LOG_QUERY = JSON.parse(JSON.stringify(METRICS_DEFAULT_QUERY));ui_log_render()">
              Reset
            </button>
            <button class="pure-button" onclick="ui_filter_open(METRICS_QUERY, ui_log_render)">
              Filter <i class="fa fa-filter"></i>
            </button>
            <div class="filters-holder"></div>
          </div>
        </header>
        <div>
          <cal class="info-card">
            <div class="info-action">
              <i class="fa fa-chevron-left"></i>
              <div class="title"></div>
              <i class="fa fa-chevron-right"></i>
            </div>
            <div class="content"></div>
          </cal>
        </div>
      </div>
      <div class="forecast" oncontextmenu="return false;">
        <header>
          <div class="actions pad">
            <button class="pure-button"
              onclick="FORECAST_QUERY = JSON.parse(JSON.stringify(FORECAST_DEFAULT_QUERY));ui_forecast_render()">
              Reset
            </button>
            <button class="pure-button" onclick="ui_filter_open(FORECAST_QUERY, ui_forecast_render)">
              Filter <i class="fa fa-filter"></i>
            </button>
            <div class="filters-holder"></div>
          </div>
        </header>
        <div class="forecast-container">

        </div>
      </div>
      <div class="settings pad" oncontextmenu="return false;">
        <div class="pad">
          <h4>Export</h4>
          <a class="pure-button" href="storage/data">
            Data take out (JSON)
          </a>
        </div>
        <div class="pad">
          <button class="pure-button"
            onclick="ui_settings_export_ledg()">
            Export as `ledg` timeclock files (1970-2100)
          </button>
          <span><a href="https://github.com/SitanHuang/ledg" target="_blank">Learn more about ledg here</a></span>
        </div>
        <div class="pad">
          <h4>User</h4>
          <form class="pure-form pure-form-aligned user-form pad" style="max-width: 600px;">
            <fieldset>
              <div class="pure-control-group">
                <label for="aligned-name">Username</label>
                <input type="text" readonly name="username"/>
                <span class="pure-form-message-inline">Contact site admin to change login.</span>
              </div>
              <div class="pure-control-group">
                <label for="aligned-email">Storage Level</label>
                <input type="text" readonly name="permission" />
                <span class="pure-form-message-inline">Contact site admin to upgrade.</span>
              </div>
              <div class="pure-control-group">
                <label for="aligned-email">Quota</label>
                <progress name="quota"></progress>
                <span class="pure-form-message-inline" name="quota"></span>
              </div>
            </fieldset>
          </form>
        </div>
        <div class="pad">
          <h4>Clean up</h4>
          <button class="pure-button"
            onclick="ui_menu_cleanup_periods()">
            Remove logs with short durations
          </button>
        </div>
      </div>
    </div>

    <div class="bottom-bar" oncontextmenu="return false">
      <div class="left" id="status-bar"></div>
      <div class="right" id="quota-status"></div>
      <i class="fas" id="sync-status"></i>
    </div>

    <!-- Modal: Create new project on add in home page -->
    <div class="modal micromodal-slide" id="modal-home-new-proj">
      <div class="modal__overlay" tabindex="-1">
        <div class="modal__container" role="dialog">
          <form autocomplete="off" onsubmit="" class="pure-form pure-form-stacked">
            <header class="modal__header">
              <h2 class="modal__title" id="modal-home-new-proj-title">
                New project
              </h2>
              <button class="modal__close" data-micromodal-close></button>
            </header>
            <main class="modal__content" id="modal-home-new-proj-content">
              <div class="pure-g">
                <div class="pure-u-1 pure-u-md-2-3">
                  <label for="multi-first-name">Name</label>
                  <input required type="text" name="name" class="pure-u-23-24" />
                </div>
                <div class="pure-u-1 pure-u-md-1-3">
                  <label for="multi-first-name">Color</label>
                  <input type="color" name="color" class="pure-u-23-24" style="padding: 0;"/>
                </div>
              </div>
              <div class="pure-g colors-container"></div>
            </main>
            <footer class="modal__footer" style="text-align: right;">
              <button type="clear" class="modal__btn" data-micromodal-close>Cancel</button>
              <button type="submit" class="modal__btn modal__btn-primary">Add</button>
            </footer>
          </form>
        </div>
      </div>
    </div>
    <!-- Modal: Filter -->
    <div class="modal micromodal-slide" id="modal-filter">
      <div class="modal__overlay" tabindex="-1">
        <div class="modal__container" role="dialog">
          <form onsubmit="return false;" autocomplete="off" class="pure-form pure-form-aligned">
            <header class="modal__header">
              <h2 class="modal__title" id="modal-filter-title">
                Set Filter
              </h2>
              <button class="modal__close" data-micromodal-close></button>
            </header>
            <main class="modal__content" id="modal-filter-content">
              <div class="pure-control-group">
                <label>Project</label>
                <input type="text" name="project">
                <span class="pure-form-message-inline">
                  "none" for tasks without project; ex. "school..hw", "school.*", "school*"; add "\v" for regex mode
                </span>
              </div>
              <div class="pure-control-group">
                <label>Selected Projects</label>
                <input type="text" name="projects" readonly>
                <span class="pure-form-message-inline">
                  to change, reset filter
                </span>
              </div>
              <div class="pure-control-group">
                <label style="vertical-align: top;">Status</label>
                <div class="stacked-checkboxes">
                  <label for="filter-checkbox-default" class="pure-checkbox">
                    <input type="checkbox" id="filter-checkbox-default">
                    Default
                  </label>
                  <label for="filter-checkbox-ready" class="pure-checkbox">
                    <input type="checkbox" id="filter-checkbox-ready">
                    Ready
                  </label>
                  <label for="filter-checkbox-start" class="pure-checkbox">
                    <input type="checkbox" id="filter-checkbox-start">
                    Started
                  </label>
                  <label for="filter-checkbox-completed" class="pure-checkbox">
                    <input type="checkbox" id="filter-checkbox-completed">
                    Completed
                  </label>
                </div>
                <span class="pure-form-message-inline">
                  queries everything if none selected
                </span>
              </div>
              <div class="pure-control-group">
                <label>Visibility</label>
                <select name="visibility">
                  <option value=""></option>
                  <option value="hidden">Hidden</option>
                  <option value="visible">Visible</option>
                </select>
              </div>
              <div class="pure-control-group">
                <label>Due</label>
                <select name="due">
                  <option value="null"></option>
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </div>
              <div class="pure-control-group">
                <label>From</label>
                <input type="date" name="from">
                <span class="pure-form-message-inline">
                  min(min(created, earliest || created), END)
                </span>
              </div>
              <div class="pure-control-group">
                <label>To</label>
                <input type="date" name="to">
                <span class="pure-form-message-inline">
                  max(max(now, due || until), START)
                </span>
              </div>
              <!-- TODO: projects -->
              <!-- TODO: ready -->
            </main>
            <footer class="modal__footer" style="text-align: right;">
              <button type="clear" class="modal__btn" data-micromodal-close>Cancel</button>
              <button type="button" onclick="ui_filter_save()" class="modal__btn">Save</button>
              <button type="submit" class="modal__btn modal__btn-primary">Apply</button>
            </footer>
          </form>
        </div>
      </div>
    </div>
    <!-- Modal: Home mode -->
    <div class="modal micromodal-slide" id="modal-home-mode">
      <div class="modal__overlay" tabindex="-1">
        <div class="modal__container" role="dialog">
          <form autocomplete="off" onsubmit="ui_home_add_project_callback(this);return false;" class="pure-form pure-form-stacked">
            <header class="modal__header">
              <h2 class="modal__title" id="modal-home-mode-title">

              </h2>
              <button class="modal__close" data-micromodal-close></button>
            </header>
            <main class="modal__content" id="modal-home-mode-content">
              <div class="pure-menu pure-menu-scrollable custom-restricted">
                <ul class="pure-menu-list">
                  <li class="pure-menu-item"
                    onclick="ui_home_mode_select_trigger('default', HOME_DEFAULT_QUERY)">
                    <a href="#" class="pure-menu-link">Default</a>
                  </li>
                  <li class="pure-menu-item"
                    onclick="ui_home_mode_select_trigger('ready', HOME_READY_QUERY)">
                    <a href="#" class="pure-menu-link">Ready</a>
                  </li>
                  <li class="pure-menu-item"
                    onclick="ui_home_mode_select_trigger('all', HOME_ALL_QUERY)">
                    <a href="#" class="pure-menu-link">All</a>
                  </li>
                  <li class="pure-menu-item"
                    onclick="ui_home_mode_select_trigger('completed', HOME_COMPLETED_QUERY)">
                    <a href="#" class="pure-menu-link">Completed</a>
                  </li>
                  <li class="pure-menu-item"
                    onclick="ui_home_mode_select_trigger('hidden', HOME_HIDDEN_QUERY)">
                    <a href="#" class="pure-menu-link">Hidden</a>
                  </li>
                </ul>
              </div>
            </main>
          </form>
        </div>
      </div>
    </div>

    <div id="timer-container" oncontextmenu="return false;" style="display: none;">
      <name></name>
      <timer></timer>
      <stop onclick="task_pause(back.data.tasks[back.data.started]);timer_stop_task(back.data.tasks[back.data.started]);ui_menu_select_home();">
        <i class="fa fa-stop-circle"></i>
      </stop>
    </div>

    <script src="libs/external/jquery-3.6.0.min.js"></script>
    <script src="libs/external/randomColor.min.js"></script>
    <script src="libs/external/micromodal.min.js"></script>
    <script src="libs/external/zip-no-worker-deflate.min.js"></script>
    <script src="libs/external/d3.v4.js"></script>
    <script src="libs/external/d3_timeseries.min.js"></script>

    <script src="libs/commons.js"></script>

    <script src="libs/data.js"></script>
    <script src="libs/task.js"></script>
    <script src="libs/project.js"></script>
    <script src="libs/backend.js"></script>

    <script src="libs/fuzzy.js"></script>
    <script src="libs/query.js"></script>

    <script src="libs/ui/filter.js"></script>

    <script src="libs/ui/views/home.js"></script>
    <script src="libs/ui/views/details.js"></script>
    <script src="libs/ui/views/gantt.js"></script>
    <script src="libs/ui/views/log.js"></script>
    <script src="libs/ui/views/settings.js"></script>
    <script src="libs/ui/views/forecast.js"></script>
    <script src="libs/ui/views/metrics.js"></script>

    <script src="libs/ui/layout.js"></script>
    <script src="libs/ui/timer.js"></script>
    <script src="libs/index.js"></script>

    <!-- lazy loads stylesheets & images -->
    <script src="libs/ui/css.js"></script>
  </body>
</html>
